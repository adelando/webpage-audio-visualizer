<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISUALIZER V17.6.25 - Adelando</title>
    <style>
        :root { --panel-bg: rgba(10, 10, 15, 0.98); --accent: #00fbff; --border: rgba(255,255,255,0.1); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', system-ui, sans-serif; color: white; }
        canvas { display: block; }
        #toggle-btn { position: absolute; top: 20px; left: 20px; background: var(--panel-bg); border: 1px solid var(--border); color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 20px; z-index: 100; display: flex; align-items: center; justify-content: center; transition: 0.4s; box-shadow: 0 4px 15px rgba(0,0,0,0.4); opacity: 0.3; }
        #toggle-btn.active { left: 335px; opacity: 1; } 
        #ui-layer { position: absolute; top: 20px; left: 20px; background: var(--panel-bg); backdrop-filter: blur(25px); border: 1px solid var(--border); border-radius: 12px; width: 330px; z-index: 10; transition: 0.4s; box-shadow: 0 15px 35px rgba(0,0,0,0.6); max-height: 92vh; overflow-y: auto; padding-bottom: 20px; }
        #ui-layer.hidden { transform: translateX(-400px); opacity: 0; pointer-events: none; }
        .header { padding: 18px 18px 2px 18px; font-weight: 800; font-size: 0.85rem; letter-spacing: 1.5px; text-transform: uppercase; color: var(--accent); }
        .controls { padding: 10px 20px; display: flex; flex-direction: column; gap: 14px; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .label-row { display: flex; justify-content: space-between; align-items: center; }
        .val { color: var(--accent); font-family: monospace; font-size: 0.8rem; font-weight: bold; }
        label { font-size: 0.6rem; text-transform: uppercase; opacity: 0.6; letter-spacing: 1px; font-weight: 700; }
        input[type="range"] { accent-color: var(--accent); cursor: pointer; height: 4px; width: 100%; }
        select, button { background: #1a1a20; color: white; border: 1px solid #333; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.7rem; }
        .primary-btn { background: var(--accent) !important; color: black !important; font-weight: 800; border: none !important; }
        .preset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px; }
        .preset-btn { font-size: 0.55rem; padding: 5px; opacity: 0.7; }
        .preset-btn:hover { opacity: 1; border-color: var(--accent); }
    </style>
</head>
<body>

    <button id="toggle-btn" class="active">‚öôÔ∏è</button>

    <div id="ui-layer">
        <div class="header">VISUALIZER V17.6.25 (RESTORED)</div>
        <div class="controls">
            <div class="control-group">
                <label>Shape Mode</label>
                <select id="baseShape">
                    <option value="starfield" selected>‚ú® Starfield Warp</option>
                    <option value="kaleidoscope">Kaleidoscope Bars</option>
                    <option value="moons">üõ∞Ô∏è Orbiting Moons</option>
                    <option value="triangle">Geometric Triangles</option>
                    <option value="hexagon">Pulsing Hexagons</option>
                    <option value="circle">Concentric Circles</option>
                    <option value="square">Nested Squares</option>
                    <option value="horizontal">Mirror Bar</option>
                </select>
            </div>

            <div class="control-group"><div class="label-row"><label>Gain</label><span class="val" id="val-sensitivity">1.0</span></div><input type="range" id="sensitivity" min="0.1" max="10.0" step="0.1" value="1.0"></div>
            <div class="control-group"><div class="label-row"><label>Spacing</label><span class="val" id="val-barSpacing">10</span></div><input type="range" id="barSpacing" min="1" max="100" step="1" value="10"></div>
            <div class="control-group"><div class="label-row"><label>Master Zoom</label><span class="val" id="val-zoom">0</span></div><input type="range" id="zoom" min="-5.0" max="5.0" step="0.1" value="0"></div>
            <div class="control-group"><div class="label-row"><label>Rotation Speed</label><span class="val" id="val-rotation">0.5</span></div><input type="range" id="rotation" min="0" max="5.0" step="0.1" value="0.5"></div>
            <div class="control-group"><div class="label-row"><label>Color Speed</label><span class="val" id="val-colorSpeed">1.0</span></div><input type="range" id="colorSpeed" min="0" max="5.0" step="0.1" value="1.0"></div>
            <div class="control-group"><div class="label-row"><label>Thickness</label><span class="val" id="val-thickness">1.5</span></div><input type="range" id="thickness" min="0.5" max="15.0" step="0.5" value="1.5"></div>
            <div class="control-group"><div class="label-row"><label>Decay (Trails)</label><span class="val" id="val-decay">0.4</span></div><input type="range" id="decay" min="0.01" max="1.0" step="0.01" value="0.4"></div>

            <button class="primary-btn" id="capture-btn">AUDIO CAPTURE</button>
            
            <label>Presets (Key 1-9)</label>
            <div class="preset-grid" id="preset-grid"></div>
        </div>
    </div>

    <canvas id="visualizer"></canvas>

    <script>
        const canvas = document.getElementById('visualizer'), ctx = canvas.getContext('2d'), ui = document.getElementById('ui-layer'), btn = document.getElementById('toggle-btn');
        let audioCtx, analyser, dataArray, isStarted = false, autoHue = 0, currentRot = 0;
        let stars = [], presets = new Array(9).fill(null);
        
        let settings = { 
            baseShape: 'starfield', barSpacing: 10, sensitivity: 1.0, thickness: 1.5, 
            decay: 0.4, zoom: 0, rotation: 0.5, colorSpeed: 1.0 
        };

        function initUI() {
            const grid = document.getElementById('preset-grid');
            for(let i=1; i<=9; i++) {
                const b = document.createElement('button');
                b.className = 'preset-btn'; b.innerText = `P${i}: SAVE`;
                b.onclick = () => { presets[i-1] = {...settings}; b.innerText = `P${i}: LOAD`; b.style.color = 'var(--accent)'; };
                grid.appendChild(b);
            }
        }

        window.onkeydown = (e) => { 
            const key = parseInt(e.key); 
            if(key >= 1 && key <= 9 && presets[key-1]) applyPreset(presets[key-1]); 
        };

        function applyPreset(p) {
            settings = {...p};
            Object.keys(settings).forEach(key => {
                const el = document.getElementById(key);
                if(el) el.value = settings[key];
                if(document.getElementById(`val-${key}`)) document.getElementById(`val-${key}`).innerText = settings[key];
            });
            initStars();
        }

        function initStars() {
            stars = [];
            for(let i=0; i<400; i++) stars.push({ x: Math.random()*2-1, y: Math.random()*2-1, z: Math.random(), orbit: Math.random()*Math.PI*2 });
        }

        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }; window.onresize();
        btn.onclick = () => { ui.classList.toggle('hidden'); btn.classList.toggle('active'); };
        initUI(); initStars();

        document.querySelectorAll('input, select').forEach(el => {
            el.oninput = (e) => {
                settings[e.target.id] = isNaN(e.target.value) ? e.target.value : parseFloat(e.target.value);
                if(document.getElementById(`val-${e.target.id}`)) document.getElementById(`val-${e.target.id}`).innerText = e.target.value;
                if(e.target.id === 'baseShape') initStars();
            };
        });

        document.getElementById('capture-btn').onclick = async () => {
            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const src = audioCtx.createMediaStreamSource(stream); analyser = audioCtx.createAnalyser();
            analyser.fftSize = 2048; src.connect(analyser); 
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            isStarted = true;
        };

        function draw() {
            requestAnimationFrame(draw);
            ctx.fillStyle = `rgba(0, 0, 0, ${settings.decay})`; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (isStarted) { analyser.getByteFrequencyData(dataArray); }
            else { if(!dataArray) dataArray = new Uint8Array(1024); for(let i=0; i<400; i++) dataArray[i] = 40 + Math.sin(Date.now()*0.002 + i*0.05)*40; }

            autoHue += settings.colorSpeed; 
            currentRot += settings.rotation * 0.01;
            const sens = settings.sensitivity, spacing = settings.barSpacing;
            const thick = settings.thickness, zoom = 3.0 + settings.zoom;

            ctx.save();
            ctx.translate(canvas.width/2, canvas.height/2); 
            ctx.scale(zoom, zoom); 
            ctx.lineWidth = thick;

            if (settings.baseShape === 'starfield') {
                ctx.rotate(currentRot);
                stars.forEach((s, i) => {
                    s.z -= 0.005; if(s.z <= 0) s.z = 1;
                    const px = (s.x / s.z) * (canvas.width/2) * (spacing/15), py = (s.y / s.z) * (canvas.height/2) * (spacing/15);
                    ctx.fillStyle = `hsl(${(autoHue + i)%360}, 80%, 60%)`;
                    ctx.beginPath(); ctx.arc(px, py, (1-s.z)*5*sens, 0, Math.PI*2); ctx.fill();
                });
            } else if (settings.baseShape === 'horizontal') {
                for (let i = 0; i < 400; i += 2) {
                    const m = (dataArray[i % 512]/255) * 150 * sens;
                    ctx.strokeStyle = `hsl(${(autoHue + i)%360}, 80%, 60%)`;
                    ctx.beginPath(); ctx.moveTo(i*(spacing*0.1), -m); ctx.lineTo(i*(spacing*0.1), m); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(-i*(spacing*0.1), -m); ctx.lineTo(-i*(spacing*0.1), m); ctx.stroke();
                }
            } else if (settings.baseShape === 'moons') {
                stars.forEach((s, i) => {
                    if (i > 80) return;
                    s.orbit += settings.rotation * 0.02; 
                    const dist = i * spacing * 0.5, m = (dataArray[i % 512]/255) * 40 * sens;
                    ctx.fillStyle = `hsl(${(autoHue + i)%360}, 80%, 60%)`;
                    ctx.beginPath(); ctx.arc(Math.cos(s.orbit)*(dist+m), Math.sin(s.orbit)*(dist+m), (thick/2) + m/8, 0, Math.PI*2); ctx.fill();
                });
            } else if (settings.baseShape === 'kaleidoscope') {
                ctx.rotate(currentRot);
                for (let i = 0; i < 150; i++) {
                    ctx.strokeStyle = `hsl(${(autoHue + i)%360}, 80%, 60%)`;
                    ctx.save(); for (let s = 0; s < 12; s++) {
                        ctx.rotate((Math.PI * 2) / 12);
                        ctx.beginPath(); ctx.moveTo(i*(spacing*0.4), 0); 
                        ctx.lineTo(i*(spacing*0.4), (dataArray[i%512]/2)*sens); ctx.stroke();
                    } ctx.restore();
                }
            } else {
                ctx.rotate(currentRot);
                for (let i = 0; i < 150; i++) {
                    const size = i * spacing + (dataArray[i % 512]/4) * sens;
                    ctx.strokeStyle = `hsl(${(autoHue + i)%360}, 80%, 60%)`;
                    ctx.beginPath();
                    if (settings.baseShape === 'circle') ctx.arc(0, 0, size, 0, Math.PI * 2);
                    else if (settings.baseShape === 'square') ctx.rect(-size/2, -size/2, size, size);
                    else if (settings.baseShape === 'hexagon') { for(let h=0; h<6; h++) { const a = (h*Math.PI/3); ctx.lineTo(size*Math.cos(a), size*Math.sin(a)); } ctx.closePath(); }
                    else if (settings.baseShape === 'triangle') { for(let t=0; t<3; t++) { const a = (t*2*Math.PI/3)-Math.PI/2; ctx.lineTo(size*Math.cos(a), size*Math.sin(a)); } ctx.closePath(); }
                    ctx.stroke();
                }
            }
            ctx.restore();
        }
        draw();
    </script>
</body>
</html>

